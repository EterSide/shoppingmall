<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/default}" lang="en">
<head>
  <style>
    .center-container {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh; /* 화면 높이를 꽉 채우도록 설정 */
    }

    .form-container {
      width: 100%;
      max-width: 400px; /* 폼의 최대 너비를 설정 */
      padding: 20px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); /* 약간의 그림자 효과 */
      border-radius: 10px; /* 테두리 둥글게 */
      background-color: #ffffff; /* 배경색 */
    }


    .preview-container img {

      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 10px;

      max-width: 100px;
      max-height: 100px;
      object-fit: cover;
      border: 1px solid #ddd;
      border-radius: 5px;
    }
  </style>
  <script>
    function checkCoupon(element) {
      const couponId = element.getAttribute('data-coupon-id');
      
      fetch(`/issued_coupon/register/${couponId}`, {
        method: 'GET',
        headers: {
          'Content-Type': 'application/json'
        }
      })
      .then(response => response.json())
      .then(data => {
        if (data.exists) {
          alert('이미 발급된 쿠폰입니다.');
        } else {
          alert('쿠폰이 발급되었습니다!');
          // 쿠폰 발급 후 UI 업데이트
          element.style.opacity = '0.5';
          element.style.pointerEvents = 'none';
          element.classList.add('disabled-coupon');
        }
      })
      .catch(error => {
        console.error('Error:', error);
        alert('쿠폰 발급 중 오류가 발생했습니다.');
      });
    }

    // 페이지 로드 시 쿠폰 클릭 이벤트 리스너 등록
    document.addEventListener('DOMContentLoaded', function() {
      const couponItems = document.querySelectorAll('.coupon-item:not(.disabled-coupon)');
      couponItems.forEach(item => {
        item.addEventListener('click', function() {
          checkCoupon(this);
        });
      });
    });
  </script>
</head>
<body>
<div layout:fragment="content">
  <div class="center-container">
    <div class="form-container">
      <h2 class="text-center">쿠폰 등록</h2>
      <th:block th:each="coupon : ${coupons}">
        <div class="mb-3 coupon-item"
             th:data-coupon-id="${coupon.coupon_id}"
             th:classappend="${coupon.has_coupon ? 'disabled-coupon' : ''}"
             th:style="${coupon.has_coupon ? 'opacity: 0.5; pointer-events: none;' : ''}">
          <div class="card border-success mb-3" style="max-width: 18rem;">
            <div class="card-header bg-transparent border-success">Header</div>
            <div class="card-body text-success">
              <h5 class="card-title" th:text="${coupon.coupon_name}"></h5>
              <p class="card-text" th:text="${coupon.description}"></p>
            </div>
            <div class="card-footer bg-transparent border-success" th:text="${coupon.endDate} + '일까지 사용가능'"></div>
          </div>
        </div>
      </th:block>
    </div>
  </div>
</div>
</body>
</html>